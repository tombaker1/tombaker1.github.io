<!DOCTYPE html>
<html>

<head>
    <style>
        .canvas-container {
            position: relative;
            overflow: hidden;
            border: 1px solid black;
            width: 400px;
            height: 300px;
        }

        canvas {
            background: white;
        }

        #controls {
            margin: 10px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        select,
        button {
            padding: 5px;
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
    
.arrow-button {
  padding: 10px 20px;
  font-size: 16px;
  border: 2px solid #0073e6;
  background-color: white;
  color: #0073e6;
  border-radius: 5px;
  cursor: pointer;
  position: relative;
}

.arrow-button:hover {
  background-color: #0073e6;
  color: white;
}

    </style>
</head>

<body>
    <div id="controls"> <button onclick="newGame()">New Game</button> 
            <button onclick="clearCanvas()">Clear
            Canvas</button> <select id="fontSelect" onchange="updateFont()">
            <option value="Arial">Arial</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Courier New">Courier New</option>
            <option value="Georgia">Georgia</option>
            <option value="Impact">Impact</option>
        </select> <select id="animationSelect">
            <option value="none">No Animation</option>
            <option value="rotate">Rotate</option>
            <option value="bounce">Bounce</option>
            <option value="fade">Fade</option>
        </select>
        <div class="zoom-controls"> 
            <label for="zoomSlider">Zoom:</label> 
            <input type="range" id="zoomSlider" min="0.1" max="5" step="0.1" value="1"> 
            <span id="zoomLevel">100%</span> 
            <button onclick="resetZoom()">Reset Zoom</button> 
        </div>
    </div>
    <div class="canvas-container"> <canvas id="letterCanvas" width="400" height="320"></canvas> </div>
    <div>
        <!--
         <button>up</button>
        <br>
        <button>left</button>
        <button>0</button>
        <button>right</button>
        <br>
        <button>down</button>
        -->
        <br>
            <button onclick="move(-1,-1);" class="arrow-button">&#x2196;</button>
            <button onclick="move(0,-1);" class="arrow-button">&#x2191;</button>
<button onclick="move(1,-1);" class="arrow-button">&#x2197;</button>
<br>
<button onclick="move(-1,0);" class="arrow-button">&#x2190;</button>
<button onclick="move(0,0);" class="arrow-button">&#x2191;</button>
<button onclick="move(1,0);" class="arrow-button">&#x2192;</button>
<br>
<button onclick="move(-1,1);" class="arrow-button">&#x2199;</button>
<button onclick="move(0,1);" class="arrow-button">&#x2193;</button>
<button onclick="move(1,1);" class="arrow-button">&#x2198;</button>
<br>

    </div>
    <div id="statusMessage">Ready</div>
    <!--
    <script type="text/javascript" src="app.js"></script>
    -->
    <script> 
    //document.getElementById("").textContent = "New Text";

        const canvas = document.getElementById('letterCanvas'); 
        const ctx = canvas.getContext('2d'); 
        const statusMessage = document.getElementById("statusMessage");
        let letters = []; 
        let holes = [];
        let zombies = [];
        let animationId; // Zoom and pan variables 
        let scale = 1; 
        let offsetX = 0; 
        let offsetY = 0; 
        let isDragging = false; 
        let lastX = 0; 
        let lastY = 0; 
        class Letter { 
            constructor() { 
                this.letter = 'Z' //ABCDEFGHIJKLMNOPQRSTUVWXYZ'[Math.floor(Math.random() * 26)]; 
                this.x = random(0, canvas.width/20); //30, canvas.width - 30); 
                this.y = random(0, canvas.height/20); //30, canvas.height - 30); 
                this.fontSize = 20 //random(20, 40); 
                this.hue = 0 //random(0, 360); 
                this.lightness = 50;
                this.opacity = 1; 
                this.rotation = 0; 
                this.yVelocity = random(-2, 2); 
                this.originalY = this.y;
            } 
            draw() { 
                ctx.save(); 
                const animationType = document.getElementById('animationSelect').value; // Apply zoom and pan transformation 
                ctx.translate(offsetX, offsetY); 
                ctx.scale(scale, scale); 
                let px = (this.x * 20) + 10;
                let py = (this.y * 20) + 10;
                ctx.translate(px,py); 
                if (animationType === 'rotate') { 
                    ctx.rotate(this.rotation); 
                } 
                ctx.font = `${this.fontSize}px ${document.getElementById('fontSelect').value}`; 
                ctx.fillStyle = `hsla(${this.hue}, 70%, ${this.lightness}%, ${this.opacity})`; 
                ctx.textAlign = 'center'; 
                ctx.textBaseline = 'middle'; 
                ctx.fillText(this.letter, 0, 0); 
                ctx.restore(); 
            } 
            update() { 
                const animationType = document.getElementById('animationSelect').value; 
                switch (animationType) { 
                    case 'rotate': this.rotation += 0.02; break; 
                    case 'bounce': this.y += this.yVelocity; 
                        if (Math.abs(this.y - this.originalY) > 20) { 
                            this.yVelocity *= -1; 
                        } break; 
                    case 'fade': this.opacity = 0.5 + Math.sin(Date.now() / 1000) * 0.5; break; 
                } 
            } 
            move(x,y) {
                this.x += x;
                this.y += y;
                statusMessage.innerHTML += `<br>   move ${this.letter} x= ${this.x},y= ${this.y}, ${x}, ${y}`;
                }
            chase(x,y) {}
        } 
        class Person extends Letter {
            constructor() {
                super();
                this.letter='Y';
                this.lightness = 0;
                this.x = canvas.width/2/20;
                this.y = canvas.height/2/20;
                }
            }
        class Zombie extends Letter {
            constructor() {
                super();
                this.letter='Z';
                this.lightness = 50;
                this.x = random(0, canvas.width/20-1);
                this.y = random(0, canvas.height/20-1);
                //this.x = canvas.width/2;
                //this.y = canvas.height/2;
                }
                
            chase(x,y) {
                //statusMessage.innerHTML += "<br>chase " + this.x + " "+ this.y;
                const dx = Math.floor(x - this.x);
                const dy = Math.floor(y - this.y);
                //statusMessage.innerHTML += "<br>chase " + dx + " " + dy + " " + this.x  + " " + this.y;
                let sx = Math.sign(dx);
                let sy = Math.sign(dy);
                let newX = this.x + sx;
                let newY = this.y + sy;
                //statusMessage.innerHTML += "<br> " + sx + " " + sy;
                //statusMessage.innerHTML = "chase " + ${dx} + " " + ${dy};
                let found = 0;
                //if (zombies.length == 0) {
                    //found = 1;
                //}
                zombies.forEach(z => {
                    
                    
                    if ((z.x == newX)&&(z.y == newY)) {
                        found = 1;
                        sx = 0;
                        sy = 0;
                        //break;
                        //statusMessage.innerHTML += " found";
                        }
                        /*
                    else if ((z.x != newX) && (z.y != this.y)){
                        found = 1;
                        newY = this.y;
                    }
                    else if ((z.x != this.x) && (z.y != newY)) {
                        found = 1;
                        newX = this.x;
                        }
                     */
                        statusMessage.innerHTML += "<br> " + z.x + " " + z.y + " " + this.x + " " + this.y + " found " + found;
                    });

                //if (found == 0) {
                    this.move(sx,sy);
                //}
                zombies.push(this);
                
            }
            
        }
        /*
        printStatus(m) {
            document.getElementById("status").innerHTML = m;

        }
        */
        function random(min, max) { 
            return Math.floor(Math.random() * (max - min + 1)) + min; 
        } 
        function addLetter() { 
            letters.push(new Zombie()); 
        } 
        function clearCanvas() { 
            letters = []; 
            ctx.clearRect(0, 0, canvas.width, canvas.height); 
        } 
        function updateFont() { 
            animate(); 
        } 
        function animate() { 
            if (animationId) { 
                cancelAnimationFrame(animationId); 
            } 
            ctx.clearRect(0, 0, canvas.width, canvas.height); 
            letters.forEach(letter => { letter.update(); letter.draw(); }); 
            if (letters.length > 0 && document.getElementById('animationSelect').value !== 'none') { 
                animationId = requestAnimationFrame(animate); 
            } 
        } 
        function updateFrame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); 
            letters.forEach(letter => { letter.update(); letter.draw(); }); 

            }
        function move(x,y) {
            let prevX = person.x;
            let prevY = person.y;
            person.move(x,y);
            zombies = [];
            letters.forEach(letter => {letter.chase(prevX, prevY);});
            updateFrame();
            }
        function newGame() {
            let numZombies = random(5,10);
            //let numHoles = Math.ceiling(numZombies/5);
            holes=[];
            letters = [];
            for (let i = 0; i < 5; i++) { 
                addLetter(); 
            }
            person = new Person;
            letters.push(person);
            animate(); 
            //
            statusMessage.innerHTML = "New Game!";
        }
        
        // Zoom control with mouse wheel 
        canvas.addEventListener('wheel', (e) => 
        { 
            e.preventDefault(); 
            const delta = e.deltaY > 0 ? 0.9 : 1.1; 
            const mouseX = e.offsetX; 
            const mouseY = e.offsetY; // Zoom around mouse position 
            const newScale = scale * delta; 
            if (newScale >= 0.1 && newScale <= 5) { 
                offsetX = mouseX - (mouseX - offsetX) * delta; 
                offsetY = mouseY - (mouseY - offsetY) * delta; 
                scale = newScale; // Update zoom slider 
                document.getElementById('zoomSlider').value = scale; 
                updateZoomLevel(); 
                animate(); 
            } 
        }); 
        
            // Pan control with mouse drag 
        canvas.addEventListener('mousedown', (e) => { isDragging = true; lastX = e.offsetX; lastY = e.offsetY; }); 
        canvas.addEventListener('mousemove', (e) => 
        { 
          if (isDragging) { 
            const deltaX = e.offsetX - lastX; 
            const deltaY = e.offsetY - lastY; 
            offsetX += deltaX; 
            offsetY += deltaY; 
            lastX = e.offsetX; 
            lastY = e.offsetY; 
            animate(); 
          } 
        }); 
        canvas.addEventListener('mouseup', () => { isDragging = false; }); 
        canvas.addEventListener('mouseleave', () => { isDragging = false; }); // Zoom slider control 
        const zoomSlider = document.getElementById('zoomSlider'); 
        zoomSlider.addEventListener('input', () => { scale = parseFloat(zoomSlider.value); updateZoomLevel(); animate(); }); 
        function updateZoomLevel() { document.getElementById('zoomLevel').textContent = `${Math.round(scale * 100)}%`; } 
        function resetZoom() { scale = 1; offsetX = 0; offsetY = 0; zoomSlider.value = 1; updateZoomLevel(); animate(); } 
        document.getElementById('animationSelect').addEventListener('change', animate); // Add initial letters 
        newGame();
    </script>
</body>

</html>
